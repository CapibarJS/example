# Использование Prisma ORM

### Шаг 1: Установка Prisma CLI

Убедитесь, что у вас установлена последняя версия Prisma CLI, выполнив команду:

```shell
nmp i -g prisma
```

---

### Шаг 2: Настройка подключения к базе данных
```shell
prisma init
```
Определите настройки подключения к базе данных PostgreSQL в файле `prisma/schema.prisma`.

Пример содержимого файла `schema.prisma`:
```prisma
generator client {
   provider = "prisma-client-js"
}
datasource db {
   provider = "postgresql"
   url      = env("DATABASE_URL")
}
```
В файле `.env` отредактируйте строку подключения в переменной `DATABASE_URL`.

---

### Шаг 3: Генерация схемы

Выполните команду prisma introspect, чтобы Prisma проанализировал вашу базу данных и создал соответствующую схему:

```shell
prisma introspect
```

При выполнении этой команды Prisma прочитает структуру вашей базы данных и сгенерирует соответствующие
модели и типы в файле `prisma/schema.prisma`.
---

### Шаг 4: Генерация клиентского кода Prisma

После генерации схемы вам нужно сгенерировать клиентский код Prisma, используя команду:

```shell
prisma generate
```

Это создаст клиентский код Prisma на основе схемы и поместит его в папку `./node_modules/@prisma/client`.

---

### Шаг 5: Обновление схемы

При изменении структуры базы данных вам нужно повторно выполнить `шаг 3` и `шаг 4`.

То есть снова запустить `prisma introspect` для обновления схемы из базы данных
и затем `prisma generate` для обновления клиентского кода Prisma.

---

# Использование двух БД

Если у вас есть две базы данных в PostgreSQL и вы хотите использовать обе в своем проекте с помощью Prisma,
вам нужно настроить два источника данных в файле `prisma/schema.prisma`. Вот как это можно сделать:

1. Откройте файл `prisma/schema.prisma` в вашем проекте.

2. Определите два источника данных, каждый со своим именем и настройками подключения к соответствующей
   базе данных. 

   Например:
   ```prisma
   datasource db1 {
     provider = "postgresql"
     url      = "postgresql://localhost:5432/database1"
   }
   
   datasource db2 {
     provider = "postgresql"
     url      = "postgresql://localhost:5432/database2"
   }
   ```
   В приведенном примере мы создали источники данных `db1` и `db2` для баз данных `database1` и `database2` соответственно.
   Укажите свои реальные настройки подключения для каждой базы данных.

3. Определите модели и таблицы для каждой базы данных, указывая соответствующий источник данных в атрибуте datasource.
   
   Например:
   ```prisma
   model User {
     id    Int    @id @default(autoincrement())
     name  String
     email String @unique
   
     @@map(name: "users", schema: "public")
   }
   
   model Product {
     id    Int    @id @default(autoincrement())
     name  String
     price Int
   
     @@map(name: "products", schema: "public")
   }
   ``` 

4. Повторите `шаг 3` для всех моделей и таблиц, указывая соответствующий источник данных.

5. После внесения изменений в файл `prisma/schema.prisma` выполните команду `prisma generate`, 
   чтобы сгенерировать обновленный клиентский код Prisma.

Теперь у вас есть два источника данных в Prisma, и вы можете использовать разные базы данных 
в своем проекте. Обратите внимание, что каждый источник данных должен иметь уникальное имя 
(`db1`, `db2` в нашем примере) и соответствующие модели должны указывать
нужный источник данных в атрибуте `datasource`.
